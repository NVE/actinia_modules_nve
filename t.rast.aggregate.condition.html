<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 <meta name="Author" content="GRASS Development Team">
 <meta http-equiv="content-language" content="en-us">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>t.rast.aggregate.condition - GRASS GIS manual</title>
 <meta name="description" content="t.rast.aggregate.condition: Aggregate multiple space time raster maps into mosaics with the given granualrity, applying a condition for valid data using r.mapcalc.">
 <meta name="keywords" content="temporal, aggregation, patch, raster, merge, patching, granularity, strds">
 <link rel="stylesheet" href="grassdocs.css" type="text/css">
</head>
<body bgcolor="white">
<div id="container">

<a href="file:///usr/lib/grass84/docs/html/index.html"><img src="grass_logo.png" alt="GRASS logo"></a>
<script>
// Create hamburger menu TOC HTML elements by the JavaScript
let temp = document.createElement('template');
const toc = '<ul class="toc-mobile-screen" id="toc-mobile-screen">' + 
'<li><a class="toc-item" href="#description">DESCRIPTION</a>' + 
'</li>' + 
'<li><a class="toc-item" href="#example">EXAMPLE</a>' + 
'<ul>' + 
'<li><a class="toc-item" href="#daily-mosaic-for-sentinel-3-fractiona-snow-cover">Daily mosaic for Sentinel-3 Fractiona Snow Cover</a>' + 
'</li>' + 
'<li><a class="toc-item" href="#5-day-moving-window-mosaic-for-sentinel-3-fractiona-snow-cover">5-day moving window mosaic for Sentinel-3 Fractiona Snow Cover</a>' + 
'</li>' + 
'</ul></li>' + 
'<li><a class="toc-item" href="#see-also">SEE ALSO</a>' + 
'</li>' + 
'<li><a class="toc-item" href="#author">AUTHOR</a>' + 
'</li>' +
'<a class="close" href="#">' +
'<img src="./hamburger_menu_close.svg" alt="close">' +
'</a>' +
'</ul>' +
'<a class="hamburger" href="#toc-mobile-screen">' +
'<img src="./hamburger_menu.svg" alt="menu">' +
'</a>';
temp.innerHTML = toc;
const grassLogoLink = document.getElementsByTagName("img")[0];
grassLogoLink.after(temp.content);
</script>
<hr class="header">

<h2>NAME</h2>
<em><b>t.rast.aggregate.condition</b></em>  - Aggregate multiple space time raster maps into mosaics with the given granualrity, applying a condition for valid data using r.mapcalc.
<h2>KEYWORDS</h2>
<a href="file:///usr/lib/grass84/docs/html/temporal.html">temporal</a>, <a href="file:///usr/lib/grass84/docs/html/topic_aggregation.html">aggregation</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#patch">patch</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#raster">raster</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#merge">merge</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#patching">patching</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#granularity">granularity</a>, <a href="file:///usr/lib/grass84/docs/html/keywords.html#strds">strds</a>
<h2>SYNOPSIS</h2>
<div id="name"><b>t.rast.aggregate.condition</b><br></div>
<b>t.rast.aggregate.condition --help</b><br>
<div id="synopsis"><b>t.rast.aggregate.condition</b> [-<b>ein</b>] <b>input</b>=<em>name</em>  [<b>where</b>=<em>sql_query</em>]   [<b>mask_label</b>=<em>string</em>]  <b>mask_value</b>=<em>string</em> <b>condition_label</b>=<em>string</em> <b>aggregation_labels</b>=<em>string</em>[,<i>string</i>,...] <b>output</b>=<em>name</em>  [<b>title</b>=<em>string</em>]   [<b>description</b>=<em>string</em>]  <b>basename</b>=<em>string</em>  [<b>offset</b>=<em>integer</em>]   [<b>suffix</b>=<em>string</em>]  <b>granularity</b>=<em>string</em>  [<b>temporal_buffer</b>=<em>string</em>]   [<b>temporal_offset</b>=<em>string</em>]   [<b>sampling</b>=<em>name</em>[,<i>name</i>,...]]  <b>aggregate_condition</b>=<em>string</em>  [<b>nprocs</b>=<em>integer</em>]   [<b>region_relation</b>=<em>string</em>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>] 
</div>

<div id="flags">
<h3>Flags:</h3>
<dl>
<dt><b>-e</b></dt>
<dd>Extend existing STRDS (requires overwrite flag)</dd>

<dt><b>-i</b></dt>
<dd>Do not process granules that are incomplete (not completely within the temporal extend of the (selected) maps of the input STRDS)</dd>

<dt><b>-n</b></dt>
<dd>Register Null maps</dd>

<dt><b>--overwrite</b></dt>
<dd>Allow output files to overwrite existing files</dd>
<dt><b>--help</b></dt>
<dd>Print usage summary</dd>
<dt><b>--verbose</b></dt>
<dd>Verbose module output</dd>
<dt><b>--quiet</b></dt>
<dd>Quiet module output</dd>
<dt><b>--ui</b></dt>
<dd>Force launching GUI dialog</dd>
</dl>
</div>

<div id="parameters">
<h3>Parameters:</h3>
<dl>
<dt><b>input</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Name of the input space time raster dataset</dd>

<dt><b>where</b>=<em>sql_query</em></dt>
<dd>WHERE conditions of SQL statement without 'where' keyword used in the temporal GIS framework</dd>
<dd>Example: start_time &gt; '2001-01-01 12:30:00'</dd>

<dt><b>mask_label</b>=<em>string</em></dt>
<dd>Semantic label of the mask raster maps</dd>

<dt><b>mask_value</b>=<em>string</em>&nbsp;<b>[required]</b></dt>
<dd>Value of the mask raster maps representing valid data</dd>

<dt><b>condition_label</b>=<em>string</em>&nbsp;<b>[required]</b></dt>
<dd>Semantic label of the condition raster maps</dd>

<dt><b>aggregation_labels</b>=<em>string[,<i>string</i>,...]</em>&nbsp;<b>[required]</b></dt>
<dd>One ore more semantic label(s) of raster map(s) to aggregate</dd>

<dt><b>output</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Name of the output space time raster dataset</dd>

<dt><b>title</b>=<em>string</em></dt>
<dd>Title of the resulting STRDS</dd>

<dt><b>description</b>=<em>string</em></dt>
<dd>Description of the resulting STRDS</dd>

<dt><b>basename</b>=<em>string</em>&nbsp;<b>[required]</b></dt>
<dd>Basename for output raster maps</dd>

<dt><b>offset</b>=<em>integer</em></dt>
<dd>Offset that is used to create the output map ids, output map id is generated as: basename_ (count + offset)</dd>
<dd>Default: <em>0</em></dd>

<dt><b>suffix</b>=<em>string</em></dt>
<dd>Suffix to add at basename: set 'gran' for granularity, 'time' for the full time format, 'num' for numerical suffix with a specific number of digits (default %05)</dd>
<dd>Default: <em>gran</em></dd>

<dt><b>granularity</b>=<em>string</em>&nbsp;<b>[required]</b></dt>
<dd>Aggregation granularity, format absolute time "x years, x months, x weeks, x days, x hours, x minutes, x seconds" or an integer value for relative time</dd>

<dt><b>temporal_buffer</b>=<em>string</em></dt>
<dd>Temporal buffer around the granule of the aggregation, format absolute time "x years, x months, x weeks, x days, x hours, x minutes, x seconds" or an integer value for relative time</dd>

<dt><b>temporal_offset</b>=<em>string</em></dt>
<dd>Temporal offset applied to the aggregation granularity, format absolute time "x years, x months, x weeks, x days, x hours, x minutes, x seconds" or an integer value for relative time</dd>

<dt><b>sampling</b>=<em>name[,<i>name</i>,...]</em></dt>
<dd>The method to be used for sampling the input dataset</dd>
<dd>Options: <em>equal, overlaps, overlapped, starts, started, finishes, finished, during, contains</em></dd>
<dd>Default: <em>contains</em></dd>

<dt><b>aggregate_condition</b>=<em>string</em>&nbsp;<b>[required]</b></dt>
<dd>Condition used to identify/select values of maps to aggregate (NULL aware method from r.mapcalc)</dd>
<dd>Options: <em>nmax, nmin, nmode</em></dd>

<dt><b>nprocs</b>=<em>integer</em></dt>
<dd>Number of threads for parallel computing</dd>
<dd>Default: <em>1</em></dd>

<dt><b>region_relation</b>=<em>string</em></dt>
<dd>Process only maps with this spatial relation to the current computational region</dd>
<dd>Options: <em>overlaps, contains, is_contained</em></dd>

</dl>
</div>
<div class="toc">
<h4 class="toc">Table of contents</h4>
<ul class="toc">
    <li class="toc"><a href="#description" class="toc">DESCRIPTION</a></li>
    <li class="toc"><a href="#example" class="toc">EXAMPLE</a>
    <ul class="toc">
        <li class="toc"><a href="#daily-mosaic-for-sentinel-3-fractiona-snow-cover" class="toc">Daily mosaic for Sentinel-3 Fractiona Snow Cover</a></li>
        <li class="toc"><a href="#5-day-moving-window-mosaic-for-sentinel-3-fractiona-snow-cover" class="toc">5-day moving window mosaic for Sentinel-3 Fractiona Snow Cover</a></li>
    </ul></li>
    <li class="toc"><a href="#see-also" class="toc">SEE ALSO</a></li>
    <li class="toc"><a href="#author" class="toc">AUTHOR</a></li>
</ul>
</div>
<h2><a name="description">DESCRIPTION</a></h2>
<em>t.rast.aggregate.condition</em> aggregates raster maps within a
space time raster dataset (STRDS) using an <em>r.mapcalc</em> expression.
It is written oriented on <em>
<a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.aggregate.html">
t.rast.aggregate</a></em> and provides many of the same options, to control
naming of the output raster maps, like:
<b>basename</b>, <b>offset</b>, <b>suffix</b>

<p>
Which and how many maps are aggregated can be controled using the
<b>granularity</b>, <b>temporal_buffer</b>, <b>temporal_offset</b>,
and <b>sampling</b> options.<p> The temporal extent of the resulting
raster maps is calculated as follows:
<em>new_start_time</em> = adjust_datetime_to_granularity(start_time) +
<em>temporal_offset</em> - <em>temporal_buffer</em><br>
<em>new_end_time</em> = adjust_datetime_to_granularity(start_time) + 
<em>granularity</em> + <em>temporal_offset</em> + <em>temporal_buffer</em>

<p>
For example, if <b>granularity</b> is set to "1 day" and the
<b>temporal_buffer</b> is set to "1 day", and the <b>temoral_offset</b> is
not given or 0, the granule for a raster map with the start_time 
"2024-12-12 13:45" will have a start_time of "2024-12-11 00:00"
and an end_time of "2024-12-14 00:00". If the <b>temporal_offset</b> is
set to "-1 day", the start_time will be "2024-12-10 00:00" and the end_time
will be "2024-12-13 00:00".

<p>
<em>t.rast.aggregate.condition</em> applies a mask (given in <b>mask_label</b>) while
selecting values from raster maps with the given <b>aggregation_labels</b> using
a condition raster map (given in the <b>condition_label</b> option). For aggregation,
those pixels in the <b>aggregation_labels</b> raster maps are selected, where the
pixels in the temporally corresponding (=equal) raster maps with the
<b>condition_label</b> meet the <b>aggregate_condition</b>.

<p>
The module assumes and requires that the input STRDS is equipped with
<em>semantic_labels</em>. <em>semantic_labels</em> are used to compile
mapcalculator expressions for each ganule (temporal extent) selected
for the given granularity.

<p>
Per granule, one raster map is produced for the <b>condition_label</b>,
aggregated with the <b>aggregate_condition</b>, plus one map for each
of the <b>aggregation_labels</b>. Semantic labels for the output raster
maps are <em>condition_label_aggregate_condition</em> for the aggregated
<b>condition_label</b> maps and <em>aggregation_label</em> for all
aggregated maps from the <b>aggregation_labels</b>.

<p>
The use case <em>t.rast.aggregate.condition</em> is written for is to be
able to aggregate satellite imagery in space and time, where cloudy
pixels are excluded and only selected values are propagated to the output
maps. A concrete example, is to aggregate Fractional Sow Cover maps from
Sentinel-3 where pixels with the lowes solar angle are selected and a
cloud mask is applied at the same time.

<p>
Both input and output of this module is a single space time raster dataset.
A subset of the input space time raster dataset can be selected using the
<b>where</b> option. In addition, input maps can be filtered spatialy using
the <b>region_relation</b> option.

<p>
If the <b>i-flag</b> is set, only granules that are fully within the
temporal extent of the (selected) temporal extent of the <b>input</b>
STRDS are processed. Granules that start before the temporal extent of
the input maps or end after the temporal extent of the input maps are
being skipped. If <b>temporal_buffer</b> or <b>temporal_offset</b> or a larger
<b>granularity</b> are given, the user should make sure that the temporal
extent of the STRDS or the raster maps selected by the <b>where</b>-clause
or spatial filter cover at least one granule.

<p>
The resulting raster maps can also be registered into an existing
Space Time Raster Dataset if the <b>e-flag</b> and <b>--overwrite</b> flags
are set.


<h2><a name="example">EXAMPLE</a></h2>

<h3><a name="daily-mosaic-for-sentinel-3-fractiona-snow-cover">Daily mosaic for Sentinel-3 Fractiona Snow Cover</a></h3>
Patching the Sentinel-3 Fractional Snow Cover (FSC) to daily mosaics, filling missing
pixels from other maps within the same granule (day), and selecting pixels with the lowest
solar zenith angle if more FSC maps contain valid values for the same pixel:
<div class="code"><pre>
t.rast.aggregate.condition input=Sentinel_3_SLSTR_FSC output=Sentinel_3_SLSTR_FSC_daily \
  --overwrite --verbose -e mask_label=S3_SLSTR_cloud_mask mask_value=0 \
  condition_label=S3_solar_zenith aggregate_condition=nmin \
  aggregation_labels=S3_SLSTR_fractional_snow_cover \
  granularity="1 day" basename=S3_SLSTR_FSC \
  title="Sentinel-3 SLSTR FSC daily" \
  description="Daily Fractional Snow Cover measurements from Seninel-3 SLSTR instrument" \
  region_relation=contains \
  where="start_time >= '2023-01' and start_time <= '2023-12'" \
  nprocs=8
t.info Sentinel_3_SLSTR_FSC
</pre></div>

<h3><a name="5-day-moving-window-mosaic-for-sentinel-3-fractiona-snow-cover">5-day moving window mosaic for Sentinel-3 Fractiona Snow Cover</a></h3>
Patching the Sentinel-3 Fractional Snow Cover (FSC) to 5-day mosaics, filling missing
pixels from other maps within the same granule, and selecting pixels with the lowest
solar zenith angle if more FSC maps contain valid values for the same pixel. The 
granule is a 5-day period (granularity + 2 * temporal_buffer), placed as a moving
window in relation to each time step (granularity) in the SpaceTimeRasterDataset. 
End time in the example is at the end of each time step (day) where the 
<em>>granule end time = start of current day + granularity + temporal_buffer +
temporal_offset</em>. Start time in the example is 4 days before the start of each
time step (day) where the <em>>granule start time = start of current day -
temporal_buffer + temporal_offset</em>.
<div class="code"><pre>
t.rast.aggregate.condition input=Sentinel_3_SLSTR_FSC output=Sentinel_3_SLSTR_FSC_5days_running \
  --overwrite --verbose -e -i mask_label=S3_SLSTR_cloud_mask mask_value=0 \
  condition_label=S3_solar_zenith aggregate_condition=nmin \
  aggregation_labels=S3_SLSTR_fractional_snow_cover \
  granularity="1 day" temporal_buffer="2 days" temporal_offset="-2 days" \
  basename=S3_SLSTR_FSC title="Sentinel-3 SLSTR FSC daily" \
  description="Daily Fractional Snow Cover measurements from Seninel-3 SLSTR instrument" \
  region_relation=contains \
  where="start_time >= '2023-01' and start_time <= '2023-12'" \
  nprocs=8
t.info Sentinel_3_SLSTR_FSC
</pre></div>

<h2><a name="see-also">SEE ALSO</a></h2>

<em>
<a href="https://grass.osgeo.org/grass-stable/manuals/r.mapcalc.html">r.mapcalc</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.aggregate.html">t.rast.aggregate</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.algebra.html">t.rast.algebra</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.mapcalc.html">t.rast.mapcalc</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.series.html">t.rast.series</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.create.html">t.create</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.info.html">t.info</a>,
<a href="https://grass.osgeo.org/grass-stable/manuals/t.merge.html">t.merge</a>
<a href="https://grass.osgeo.org/grass-stable/manuals/addons/t.rast.patch.html">t.rast.patch</a>,
</em>
<p>
<a href="http://grasswiki.osgeo.org/wiki/Temporal_data_processing">Temporal data processing Wiki</a>

<h2><a name="author">AUTHOR</a></h2>

Stefan Blumentrath, NVE
<h2>SOURCE CODE</h2>
<p>
  Available at:
  <a href="">t.rast.aggregate.condition source code</a>
  (<a href="">history</a>)
</p>
<p>
  Accessed: Wednesday Aug 20 11:09:19 2025
</p>
<hr class="header">
<p>
<a href="file:///usr/lib/grass84/docs/html/index.html">Main index</a> |
<a href="file:///usr/lib/grass84/docs/html/temporal.html">Temporal index</a> |
<a href="file:///usr/lib/grass84/docs/html/topics.html">Topics index</a> |
<a href="file:///usr/lib/grass84/docs/html/keywords.html">Keywords index</a> |
<a href="file:///usr/lib/grass84/docs/html/graphical_index.html">Graphical index</a> |
<a href="file:///usr/lib/grass84/docs/html/full_index.html">Full index</a>
</p>
<p>
&copy; 2003-2025
<a href="https://grass.osgeo.org">GRASS Development Team</a>,
GRASS GIS 8.4.1 Reference Manual
</p>

</div>
</body>
</html>
